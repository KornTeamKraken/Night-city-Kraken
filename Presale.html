<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KRAKEN Token Presale</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Orbitron', sans-serif; }
    body { 
      background: linear-gradient(135deg, #0a0015 0%, #1a0033 50%, #2a0055 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 50% 50%, rgba(138, 43, 226, 0.1) 0%, transparent 50%);
      pointer-events: none;
      animation: pulse 8s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }
    .glow {
      box-shadow: 0 0 20px rgba(138, 43, 226, 0.6), 0 0 40px rgba(255, 20, 147, 0.4);
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 20px rgba(138, 43, 226, 0.6), 0 0 40px rgba(255, 20, 147, 0.4); }
      to { box-shadow: 0 0 30px rgba(138, 43, 226, 0.8), 0 0 60px rgba(255, 20, 147, 0.6); }
    }
    .neon-text {
      text-shadow: 0 0 10px rgba(138, 43, 226, 0.8), 0 0 20px rgba(255, 20, 147, 0.6), 0 0 30px rgba(138, 43, 226, 0.4);
    }
    .cyber-border {
      border: 2px solid transparent;
      background: linear-gradient(#0a0015, #0a0015) padding-box,
                  linear-gradient(135deg, #8a2be2, #ff1493) border-box;
    }
    .progress-bar {
      background: linear-gradient(90deg, #8a2be2 0%, #ff1493 100%);
      box-shadow: 0 0 20px rgba(138, 43, 226, 0.8);
      animation: shimmer 2s linear infinite;
    }
    @keyframes shimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 200% 0; }
    }
    .card {
      background: rgba(10, 0, 21, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(138, 43, 226, 0.3);
    }
    .btn-primary {
      background: linear-gradient(135deg, #8a2be2, #ff1493);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(138, 43, 226, 0.6);
    }
    .listing-banner {
      background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(255, 20, 147, 0.2));
      border: 2px solid #8a2be2;
      animation: borderGlow 2s ease-in-out infinite;
    }
    @keyframes borderGlow {
      0%, 100% { border-color: #8a2be2; }
      50% { border-color: #ff1493; }
    }
  </style>
</head>
<body class="text-white">
  <div class="container mx-auto px-4 py-8 max-w-6xl relative z-10">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-5xl font-bold neon-text">KRAKEN TOKEN</h1>
      <button id="connectWallet" class="btn-primary px-6 py-3 rounded-lg font-bold">
        Connecter Wallet Solana
      </button>
    </div>

    <!-- BanniÃ¨re Listing -->
    <div class="listing-banner rounded-xl p-6 mb-8 text-center">
      <h2 class="text-3xl font-bold mb-2 neon-text">ðŸš€ LISTING GARANTI Ã€ $0.12</h2>
      <p class="text-xl text-purple-300">Token listÃ© sur les DEX Solana dÃ¨s la fin de la Phase 5</p>
      <p class="text-lg text-pink-400 mt-2">ðŸ’Ž Achetez maintenant Ã  $0.06 = x2 garanti au listing !</p>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="card p-6 rounded-xl text-center cyber-border">
        <div class="text-sm text-purple-400 mb-2">Prix Actuel</div>
        <div class="text-3xl font-bold text-pink-500" id="currentPrice">...</div>
      </div>
      <div class="card p-6 rounded-xl text-center cyber-border">
        <div class="text-sm text-purple-400 mb-2">Tokens Vendus</div>
        <div class="text-3xl font-bold text-purple-400" id="tokensSold">...</div>
      </div>
      <div class="card p-6 rounded-xl text-center cyber-border">
        <div class="text-sm text-purple-400 mb-2">Prochain Prix</div>
        <div class="text-3xl font-bold text-pink-500" id="nextPrice">...</div>
      </div>
      <div class="card p-6 rounded-xl text-center cyber-border">
        <div class="text-sm text-purple-400 mb-2">Max Supply</div>
        <div class="text-3xl font-bold text-purple-400">10M</div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="card p-6 rounded-xl mb-8 cyber-border">
      <div class="flex justify-between mb-2">
        <span class="text-sm text-purple-400">Phase <span id="currentPhase">-</span></span>
        <span class="text-sm text-pink-400" id="progressPercent">0%</span>
      </div>
      <div class="w-full bg-gray-800 rounded-full h-4 overflow-hidden">
        <div class="progress-bar h-full rounded-full" id="progressBar" style="width: 0%"></div>
      </div>
    </div>

    <!-- Balance User -->
    <div id="userBalance" class="hidden card p-6 rounded-xl mb-8 cyber-border">
      <h3 class="text-xl font-bold mb-4 text-purple-400">Votre Balance</h3>
      <div class="grid grid-cols-3 gap-4">
        <div class="text-center">
          <div class="text-sm text-gray-400">Total</div>
          <div class="text-2xl font-bold text-purple-400" id="totalBalance">0</div>
        </div>
        <div class="text-center">
          <div class="text-sm text-gray-400">StakÃ©</div>
          <div class="text-2xl font-bold text-pink-500" id="stakedBalance">0</div>
        </div>
        <div class="text-center">
          <div class="text-sm text-gray-400">Disponible</div>
          <div class="text-2xl font-bold text-green-400" id="availableBalance">0</div>
        </div>
      </div>
    </div>

    <div class="text-center text-gray-400 py-8">
      <p>âœ… ConnectÃ© au backend: <span class="text-green-400 font-bold">http://158.178.197.42</span></p>
      <p class="text-sm mt-2">Les donnÃ©es sont maintenant sauvegardÃ©es sur le serveur</p>
    </div>

  </div>

  <script>
    const API_URL = 'http://158.178.197.42';
    const SOLANA_ADDRESS = "4P4oWnPgW9DHk251scY5ndo9J4HjEiyKPUgchwrRKC9o";
    
    let connectedWallet = null;

    // Charger stats au dÃ©marrage
    async function loadStats() {
      try {
        const res = await fetch(`${API_URL}/api/stats`);
        const data = await res.json();
        
        document.getElementById('currentPrice').textContent = `$${data.currentPrice.toFixed(3)}`;
        document.getElementById('tokensSold').textContent = data.totalSold.toLocaleString();
        document.getElementById('nextPrice').textContent = data.nextPrice ? `$${data.nextPrice.toFixed(3)}` : 'Final';
        document.getElementById('currentPhase').textContent = data.currentPhase;
        document.getElementById('progressPercent').textContent = `${data.progress.toFixed(2)}%`;
        document.getElementById('progressBar').style.width = `${data.progress}%`;
      } catch (err) {
        console.error('Erreur stats:', err);
        alert('Erreur connexion au backend !');
      }
    }

    // Connexion wallet
    document.getElementById('connectWallet').addEventListener('click', async () => {
      if (!window.solana?.isPhantom) {
        window.open('https://phantom.app/', '_blank');
        return;
      }

      try {
        const resp = await window.solana.connect();
        connectedWallet = resp.publicKey.toString();
        
        // Enregistrer dans le backend
        await fetch(`${API_URL}/api/user/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ wallet: connectedWallet })
        });
        
        document.getElementById('connectWallet').textContent = `${connectedWallet.slice(0,4)}...${connectedWallet.slice(-4)}`;
        document.getElementById('connectWallet').classList.add('bg-green-600');
        
        await loadUserData();
      } catch (err) {
        console.error('Erreur:', err);
        alert('Erreur connexion wallet');
      }
    });

    // Charger donnÃ©es user
    async function loadUserData() {
      try {
        const res = await fetch(`${API_URL}/api/user/${connectedWallet}`);
        const data = await res.json();
        
        document.getElementById('userBalance').classList.remove('hidden');
        document.getElementById('totalBalance').textContent = (parseFloat(data.user.virtual_balance) + parseFloat(data.user.staked_balance)).toLocaleString();
        document.getElementById('stakedBalance').textContent = parseFloat(data.user.staked_balance).toLocaleString();
        document.getElementById('availableBalance').textContent = parseFloat(data.user.virtual_balance).toLocaleString();
      } catch (err) {
        console.error('Erreur user:', err);
      }
    }

    // DÃ©marrer
    loadStats();
    setInterval(loadStats, 30000); // Refresh toutes les 30s
  </script>
</body>
</html>
